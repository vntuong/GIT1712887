#include <fcntl.h> 
#include <io.h>   
#include <stdio.h>
#include <conio.h>
#include <string>
struct SinhVien
{
	wchar_t* MSSV;
	wchar_t* HoTen;
	wchar_t* Khoa;
	wchar_t* KhoaHoc;
	wchar_t* NgaySinh;
	wchar_t* Anh;
	wchar_t* Email;
	wchar_t* MoTa;
	wchar_t* SoThich;
};
typedef struct SinhVien SINHVIEN;
int countLine(FILE *f)
{
	int line = 0;
	wchar_t ch;
	do
	{
		ch = fgetwc(f);
		if (ch == L'\n')
		{
			line++;
		}
	} while (ch != WEOF);
	fseek(f, 0, SEEK_SET);
	return line;
}

void DocFileSinhVienCSV(FILE* DuLieu, SINHVIEN* &sv, int line)
{
	for (int i = 0; i < line; i++)
	{
		wchar_t* buf = (wchar_t*)malloc(150 * sizeof(wchar_t));
		fgetws(buf, 150, DuLieu);
		(*(sv + i)).MSSV = wcstok(buf, L",");
		(*(sv + i)).HoTen = wcstok(NULL, L",");
		(*(sv + i)).Khoa = wcstok(NULL, L",");
		(*(sv + i)).KhoaHoc = wcstok(NULL, L",");
		(*(sv + i)).NgaySinh = wcstok(NULL, L",");
		(*(sv + i)).Anh = wcstok(NULL, L",");
		(*(sv + i)).Email = wcstok(NULL, L",");
		(*(sv + i)).MoTa = wcstok(NULL, L",");
		(*(sv + i)).SoThich = wcstok(NULL, L"\n");
	}
}
void XuatSV(SINHVIEN* sv, int line)
{
	for (int i = 0; i < line; i++)
	{
		wprintf(L"%ls, %ls, %ls, %ls, %ls, %ls, %ls, %ls, %ls\n", sv[i].MSSV, sv[i].HoTen, sv[i].Khoa, sv[i].KhoaHoc, sv[i].NgaySinh, sv[i].Anh, sv[i].Email, sv[i].MoTa, sv[i].SoThich);
	}
}

void xuatHTML(SINHVIEN sv)
{
	wchar_t filename[50];
	wcscpy(filename, L"website\\");
	wcscat(filename, sv.MSSV);
	wcscat(filename, L".htm");
	FILE*fp = _wfopen(filename, L"wt, ccs=UTF-8");
	fwprintf(fp, L"<!DOCTYPE html PUBLIC \"-\//W3C//DTD XHTML 1.0 Transitional\//EN\"\n");
	fwprintf(fp, L"\"http:\//www.w3.org\/TR\/xhtml1\/DTD\/xhtml1-transitional.dtd\">\n");
	fwprintf(fp, L"<html xmlns=\"http:\//www.w3.org\/1999\/xhtml\">\n");
	fwprintf(fp, L"<head>\n");
	fwprintf(fp, L"<meta http-equiv=\"Content-Type\" content=\"text\/html; charset=utf-8\" \/>\n");
	fwprintf(fp, L"<link rel=\"stylesheet\" type=\"text\/css\" href=\"personal.css\" \/>\n");
	fwprintf(fp, L"<title>HCMUS - %s<\/title>\n", sv.HoTen);
	fwprintf(fp, L"<\/head>\n");
	fwprintf(fp, L"<body>\n");
	fwprintf(fp, L"<div class=\"Layout_container\">\n");
	fwprintf(fp, L"<!-- Begin Layout Banner Region -->\n");
	fwprintf(fp, L"<div class=\"Layout_Banner\" >\n");
	fwprintf(fp, L"<div><img id=\"logo\" src=\"Images\/logo.jpg\" height=\"105\"\/><\/div>\n");
	fwprintf(fp, L"<div class=\"Header_Title\">TRU?NG Ð?I H?C KHOA H?C T? NHIÊN<\/div>\n");
	fwprintf(fp, L"<\/div>\n");
	fwprintf(fp, L"<!-- End Layout Banner Region -->\n");
	fwprintf(fp, L"<!-- Begin Layout MainContents Region -->\n");
	fwprintf(fp, L"<div class=\"Layout_MainContents\">\n");
	fwprintf(fp, L"<!-- Begin Below Banner Region -->\n");
	fwprintf(fp, L"<div class=\"Personal_Main_Information\">\n");
	fwprintf(fp, L"<!-- Begin Thông tin cá nhân c?a sinh viên ----------------\n");
	fwprintf(fp, L"------------------------------------------------------------------------- -->\n");
	fwprintf(fp, L"<div class=\"Personal_Location\">\n");
	fwprintf(fp, L"<img src=\"Images\/LogoFooter.jpg\" width=\"27\"height=\"33\" \/>\n");
	fwprintf(fp, L"<div class=\"Personal_FullName\">%s - %s<\/div>\n", sv.HoTen, sv.MSSV);
	fwprintf(fp, L"<div class=\"Personal_Department\">Khoa %s<\/div>\n", sv.Khoa);
	fwprintf(fp, L"<br \/>\n");
	fwprintf(fp, L"<div class=\"Personal_Phone\">\n");
	fwprintf(fp, L"Email: %s\n", sv.Email);
	fwprintf(fp, L"<\/div>\n");
	fwprintf(fp, L"<br \/>\n");
	fwprintf(fp, L"<br \/>\n");
	fwprintf(fp, L"</div>\n");
	fwprintf(fp, L"<!-- End Thông tin cá nhân c?a sinh viên ------------------\n");
	fwprintf(fp, L"----------------------------------------------------------------------- -->\n");
	fwprintf(fp, L"<div class=\"Personal_HinhcanhanKhung\">\n");
	fwprintf(fp, L"<img src=\"Images\/%s\"\n", sv.Anh);
	fwprintf(fp, L"class=\"Personal_Hinhcanhan\" \/>\n");
	fwprintf(fp, L"<\/div>\n");
	fwprintf(fp, L"<\/div>\n");
	fwprintf(fp, L"<!-- End Below Banner Region -->\n");
	fwprintf(fp, L"<!-- Begin MainContents Region -->\n");
	fwprintf(fp, L"<div class=\"MainContain\">\n");
	fwprintf(fp, L"<!-- Begin Top Region -->\n");
	fwprintf(fp, L"<div class=\"MainContain_Top\">\n");
	fwprintf(fp, L"<div class=\"InfoGroup\">Thông tin cá nhân<\/div>\n");
	fwprintf(fp, L"<div>\n");
	fwprintf(fp, L"<ul class=\"TextInList\">\n");
	fwprintf(fp, L"<li>H? và tên: %s<\/li>\n", sv.HoTen);
	fwprintf(fp, L"<li>MSSV: %s<\/li>\n", sv.MSSV);
	fwprintf(fp, L"<li>Sinh viên khoa %s<\/li>\n", sv.Khoa);
	fwprintf(fp, L"<li>Ngày sinh: %s<\/li>\n", sv.NgaySinh);
	fwprintf(fp, L"<li>Email: %s<\/li>\n", sv.Email);
	fwprintf(fp, L"<\/ul>\n");
	fwprintf(fp, L"<\/div>\n");
	fwprintf(fp, L"<div class=\"InfoGroup\">S? thích<\/div>\n");
	fwprintf(fp, L"<div>\n");
	fwprintf(fp, L"<ul class=\"TextInList\">\n");
	fwprintf(fp, L"<li>%s<\/li>\n", sv.SoThich);
	fwprintf(fp, L"<\/ul>\n");
	fwprintf(fp, L"<\/div>\n");
	fwprintf(fp, L"<div class=\"InfoGroup\">Mô t?<\/div>\n");
	fwprintf(fp, L"<div class=\"Description\">\n");
	fwprintf(fp, L"%s\n", sv.MoTa);
	fwprintf(fp, L"<\/div>\n");
	fwprintf(fp, L"<\/div>\n");
	fwprintf(fp, L"<\/div>\n");
	fwprintf(fp, L"<\/div>\n");
	fwprintf(fp, L"<!-- Begin Layout Footer -->\n");
	fwprintf(fp, L"<div class=\"Layout_Footer\">\n");
	fwprintf(fp, L"<div class=\"divCopyright\">\n");
	fwprintf(fp, L"<br \/>\n");
	fwprintf(fp, L"<img src=\"Images\/LogoFooter_gray.jpg\" width=\"34\" height=\"41\" \/><br \/>\n");
	fwprintf(fp, L"<br \/>\n");
	fwprintf(fp, L"@2018<\/br>\n");
	fwprintf(fp, L"Ð? án gi? k?<\/br>\n");
	fwprintf(fp, L"K? thu?t l?p trình<\/br>\n");
	fwprintf(fp, L"TH2017\/18<\/br>\n");
	fwprintf(fp, L"1712887 - Võ Nh?t Tu?ng<\/br>\n");
	fwprintf(fp, L"<\/div>\n");
	fwprintf(fp, L"<\/div>\n");
	fwprintf(fp, L"<!-- End Layout Footer -->\n");
	fwprintf(fp, L"<\/div>\n");
	fwprintf(fp, L"<\/body>\n");
	fwprintf(fp, L"<\/html>\n");
	fclose(fp);
}
void main()
{
	_setmode(_fileno(stdout), _O_U8TEXT);
	_setmode(_fileno(stdin), _O_U8TEXT);
	SINHVIEN* sv = (SINHVIEN*)malloc(10 * sizeof(SINHVIEN));
	FILE* DuLieu = _wfopen(L"DuLieuSinhVien.csv", L"rt, ccs = UTF-8");
	int line = countLine(DuLieu);
	DocFileSinhVienCSV(DuLieu, sv, line);
	XuatSV(sv, line);
	for (int i = 0; i < line; i++)
	{
		xuatHTML(sv[i]);
	}
	free(sv);
	fclose(DuLieu);
}